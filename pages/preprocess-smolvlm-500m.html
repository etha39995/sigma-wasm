<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <title>VQA & Image Captioning Demo - Sigma WASM</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/webp" href="/rustacean.webp">
    <link rel="apple-touch-icon" href="/rustacean.webp">
    <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
    <div id="fullscreen">
        <div class="preprocess-container">
            <a href="/" class="home-link" title="Home">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </a>
            <h1>SmolVLM-500M Demo</h1>
            <div id="error" class="error-message"></div>
            <div class="clear-cache-container">
                <button id="clearCacheBtn" class="button">Clear Cache</button>
            </div>
            <div id="loadingIndicator" class="loading-indicator"></div>
            <div id="downloadCheckmarks" class="download-checkmarks-container">
                <div id="checkmark-vision-encoder" class="download-checkmark">
                    <span class="checkmark-icon">✓</span>
                    <span>Vision Encoder</span>
                </div>
                <div id="checkmark-decoder" class="download-checkmark">
                    <span class="checkmark-icon">✓</span>
                    <span>Decoder Model</span>
                </div>
                <div id="checkmark-tokenizer" class="download-checkmark">
                    <span class="checkmark-icon">✓</span>
                    <span>Tokenizer</span>
                </div>
            </div>
            <div id="downloadLogs" class="download-logs-container">
                <h3>Download Log</h3>
                <div id="downloadLogsContent" class="download-logs-content"></div>
            </div>
            
                <div class="preprocess-section">
                    <h2>About Visual Question Answering & Image Captioning</h2>
                    <p>
                        This demo showcases <strong>Visual Question Answering (VQA)</strong> and <strong>Image Captioning</strong> using vision-language models from Hugging Face, 
                        integrated with <strong>WebAssembly (WASM) preprocessing</strong> for high-performance image preparation.
                    </p>
                    <p>
                        <strong>Architecture:</strong> Images are preprocessed using Rust-compiled WASM (Lanczos3 resizing to 224×224), 
                        then passed to SmolVLM-500M running in the browser via ONNX Runtime Web. The models perform VQA and captioning 
                        entirely client-side using WASM acceleration (with WebGPU as an optional secondary backend).
                    </p>
                    <p>
                        <strong>Image Processing:</strong> WASM preprocessing resizes images to 224×224 using high-quality Lanczos3 filtering. 
                        The preprocessed image is then fed to the models for inference, generating answers to questions or text descriptions.
                    </p>
                    <p>
                        <strong>Features:</strong>
                        <ul>
                            <li><strong>Image Captioning:</strong> Generate descriptions of visual content</li>
                            <li><strong>Visual Question Answering:</strong> Answer questions based on image/stream content</li>
                        </ul>
                    </p>
                    <p>
                        <strong>Model:</strong> SmolVLM-500M runs entirely in the browser using ONNX Runtime Web with WASM acceleration (and optional WebGPU support), enabling fully on-device AI without server calls.
                    </p>
                </div>
            
                <div class="preprocess-section">
                    <h2>Image Captioning</h2>
                    <p>Upload an image or use your webcam to capture a snapshot, then generate a description of the visual content</p>
                
                <div style="margin: 1rem 0;">
                    <h3>Webcam Capture</h3>
                    <video id="webcamVideo" autoplay playsinline style="max-width: 100%; border: 1px solid #333; border-radius: 4px; display: none;"></video>
                    <div id="webcamControls" style="margin: 0.5rem 0;">
                        <button id="startWebcamBtn">Start Webcam</button>
                        <button id="stopWebcamBtn" style="display: none;">Stop Webcam</button>
                        <button id="snapshotBtn" style="display: none;">Capture Snapshot</button>
                    </div>
                </div>
                
                <div style="margin: 1rem 0;">
                    <h3>Or Upload Image</h3>
                    <input type="file" id="imageInput" accept="image/*">
                    <div id="imagePreviewContainer">
                        <img id="imagePreview" alt="Image preview">
                    </div>
                </div>
                
                <div style="margin: 1rem 0;">
                    <h3>Image Filters</h3>
                    <div style="margin: 0.5rem 0;">
                        <label for="contrastSlider">Contrast: <span id="contrastValue">0</span></label>
                        <input type="range" id="contrastSlider" min="-100" max="100" value="0" step="1">
                    </div>
                    <div style="margin: 0.5rem 0;">
                        <label for="cinematicSlider">Cinematic Filter: <span id="cinematicValue">0</span>%</label>
                        <input type="range" id="cinematicSlider" min="0" max="100" value="0" step="1">
                    </div>
                </div>
                
                <button id="processImageBtn">Generate Caption</button>
                <div>
                    <canvas id="imageOutput"></canvas>
                </div>
                <div id="statsOutput"></div>
            </div>
            
            <div class="preprocess-section">
                <h2>Visual Question Answering (VQA)</h2>
                <p>Ask questions about the uploaded image or webcam stream content</p>
                
                <div style="margin: 1rem 0;">
                    <h3>Question</h3>
                    <textarea id="vqaQuestionInput" rows="3" cols="50" placeholder="Enter your question about the image..."></textarea>
                </div>
                
                <button id="processVQABtn">Ask Question</button>
                <div id="vqaAnswerOutput"></div>
            </div>
        </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
</body>
</html>

